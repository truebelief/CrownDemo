/**
*
* MOD3 3D Modifier Library for JavaScript
* port of AS3DMod ActionScript3 library (http://code.google.com/p/as3dmod/)
*
* http://github.com/foo123/MOD3
*
* @support Three.js, J3D, Copperlicht, CubicVR.js, Pre3D
*
* @author Nikos M. http://nikos-web-development.netai.net/
*
**/var MOD3=MOD3||{VERSION:"0.3"};!function(t){t.Constants={PI:Math.PI,invPI:1/Math.PI,halfPI:.5*Math.PI,doublePI:2*Math.PI,toRad:Math.PI/180,toDeg:180/Math.PI},t.ModConstant={LEFT:-1,RIGHT:1,NONE:0,X:1,Y:2,Z:4},t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.VecArray=t.Array32F;var e=Object.prototype.hasOwnProperty,n=Array.prototype.slice,i=(Array.prototype.splice,function(){var t=n.call(arguments),e=t.length;if(e){var i=t.shift();if(this.__super__[i])return this.__super__[i].apply(this,t)}return null}),r=t.Merge=function(t,n){t=t||{};for(var i in n)e.call(n,i)&&(t[i]=n[i]);return t};t.Extends=t.Inherits=t.SubClass=function(t,e){var n=function(){},s=e.constructor;return n.prototype=t.prototype,s.prototype=new n,s.prototype.constructor=s,s.prototype=r(s.prototype,e),s.prototype.__super__=t.prototype,s.prototype.superCall=i,s}}(MOD3),function(t,e){var n,i=t.Constants.toRad,r=t.Constants.toDeg,s=Math.min,h=Math.max,o=Math.pow,a=Math.round,u=Math.florr,c=Math.ceil,l=t.XMath={normalize:function(t,e,i){var r,s=e-t;return r=0==s?1:n(0,1,(i-t)/e)},toRange:function(t,e,n){var i,r=e-t;return i=0==r?0:t+(e-t)*n},inRange:function(t,n,i,r){return r===e&&(r=!1),r?i>=t&&n>=i:i>t&&n>i},sign:function(t,n){return n===e&&(n=0),0==t?n:t>0?1:-1},trim:function(t,e,n){return s(e,h(t,n))},wrap:function(t,e,n){var i=e-t;return t>n?n+i:n>=e?n-i:n},degToRad:function(t){return t*i},radToDeg:function(t){return t*r},presicion:function(t,e){var n=o(10,e);return a(t*n)/n},uceil:function(t){return 0>t?u(t):c(t)}};n=l.clamp=l.trim}(MOD3),function(t,e){var n=t.XMath.normalize,i=t.XMath.toRange,r=t.XMath.trim;t.Range=t.Extends(Object,{constructor:function(t,n){this.start=0,this.end=1,t!==e&&(this.start=t),n!==e&&(this.end=n)},start:0,end:1,getSize:function(){return this.end-this.start},move:function(t){this.start+=t,this.end+=t},isIn:function(t){return t>=this.start&&t<=this.end},normalize:function(t){return n(this.start,this.end,t)},toRange:function(t){return i(this.start,this.end,t)},trim:function(t){return r(this.start,this.end,t)},interpolate:function(t,e){return i(this.start,this.end,e.normalize(t))},toString:function(){return"["+this.start+" - "+this.end+"]"}})}(MOD3),function(t,e){var n=Math.sin,i=Math.abs;t.Phase=t.Extends(Object,{constructor:function(t){this.value=0,t!==e&&(this.value=t)},value:0,getPhasedValue:function(){return n(this.value)},getAbsPhasedValue:function(){return i(n(this.value))},getNormValue:function(){return.5*(n(this.value)+1)}})}(MOD3),function(t,e){var n=t.Point=t.Extends(Object,{constructor:function(t,n){this.x=t===e?0:t,this.y=n===e?0:n},x:0,y:0,clone:function(){return new n(this.x,this.y)}})}(MOD3),function(t,e){var n=Math.sin,i=Math.cos,r=t.Point,s=t.Matrix=t.Extends(Object,{constructor:function(t,n,i,r){this.m11=t===e?1:t,this.m12=n===e?0:n,this.m21=i===e?0:i,this.m22=r===e?1:r},m11:1,m12:0,m21:0,m22:1,reset:function(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this},rotate:function(t){var e=i(t),r=n(t);return this.m11=e,this.m12=-r,this.m21=r,this.m22=e,this},scale:function(t,n){return this.m12=0,this.m21=0,t!==e&&(this.m11=t,this.m22=t),n!==e&&(this.m22=n),this},multiply:function(t){var e=this.m11,n=this.m12,i=this.m21,r=this.m22,s=t.m11,h=t.m12,o=t.m21,a=t.m22;return this.m11=e*s+n*o,this.m12=e*h+n*a,this.m21=i*s+r*o,this.m22=i*h+r*a,this},transformPoint:function(t){var e=t.x,n=t.y,i=this.m11*e+this.m12*n,s=this.m21*e+this.m22*n;return new r(i,s)},transformPointSelf:function(t){var e=t.x,n=t.y;return t.x=this.m11*e+this.m12*n,t.y=this.m21*e+this.m22*n,t},clone:function(){return new s(this.m11,this.m12,this.m21,this.m22)}})}(MOD3),function(t,e){var n=Math.sqrt,i=t.VecArray,r=t.Vector3=t.Extends(Object,{constructor:function(t,n,r){t&&t.length?this.xyz=new i([t[0],t[1],t[2]]):(t=t===e?0:t,n=n===e?0:n,r=r===e?0:r,this.xyz=new i([t,n,r]))},xyz:null,getXYZ:function(){return new i(this.xyz)},getXYZRef:function(){return this.xyz},setXYZ:function(t){return this.xyz=new i(t),this},setXYZRef:function(t){return this.xyz=t,this},clone:function(){return new r(this.xyz)},equalsSelf:function(t){var e=this.xyz,n=t.xyz;return e[0]==n[0]&&e[1]==n[1]&&e[2]==n[2]},zeroSelf:function(){return this.xyz[0]=0,this.xyz[1]=0,this.xyz[2]=0,this},negate:function(){var t=this.xyz;return new r([-t[0],-t[1],-t[2]])},negateSelf:function(){var t=this.xyz;return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],this},add:function(t){var e=this.xyz,n=t.xyz;return new r([e[0]+n[0],e[1]+n[1],e[2]+n[2]])},addSelf:function(t){var e=this.xyz,n=t.xyz;return e[0]+=n[0],e[1]+=n[1],e[2]+=n[2],this},subtract:function(t){var e=this.xyz,n=t.xyz;return new r([e[0]-n[0],e[1]-n[1],e[2]-n[2]])},subtractSelf:function(t){var e=this.xyz,n=t.xyz;return e[0]-=n[0],e[1]-=n[1],e[2]-=n[2],this},multiplyScalar:function(t){var e=this.xyz;return new r([e[0]*t,e[1]*t,e[2]*t])},multiplyScalarSelf:function(t){var e=this.xyz;return e[0]*=t,e[1]*=t,e[2]*=t,this},multiply:function(t){var e=this.xyz,n=t.xyz;return new r([e[0]*n[0],e[1]*n[1],e[2]*n[2]])},multiplySelf:function(t){var e=this.xyz,n=t.xyz;return e[0]*=n[0],e[1]*=n[1],e[2]*=n[2],this},divide:function(t){var e=1/t,n=this.xyz;return new r([n[0]*e,n[1]*e,n[2]*e])},divideSelf:function(t){var e=1/t,n=this.xyz;return n[0]*=e,n[1]*=e,n[2]*=e,this},normalize:function(){var t,e=this.xyz,i=e[0],s=e[1],h=e[2],o=i*i+s*s+h*h;return o>0&&(t=1/n(o),i*=t,s*=t,h*=t),new r([i,s,h])},normalizeSelf:function(){var t,e=this.xyz,i=e[0],r=e[1],s=e[2],h=i*i+r*r+s*s;return h>0&&(t=1/n(h),i*=t,r*=t,s*=t),e[0]=i,e[1]=r,e[2]=s,this},getMagnitude:function(){var t=this.xyz,e=t[0],i=t[1],r=t[2];return n(e*e+i*i+r*r)},setMagnitude:function(t){this.normalizeSelf();var e=this.xyz;return e[0]*=t,e[1]*=t,e[2]*=t,this},dotSelf:function(t){var e=this.xyz,n=t.xyz;return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]},crossSelf:function(t){var e=this.xyz,n=t.xyz,i=e[0],r=e[1],s=e[2],h=n[0],o=n[1],a=n[2];return e[0]=r*a-s*o,e[1]=s*h-i*a,e[2]=i*o-r*h,this},distanceSelf:function(t){var e=this.xyz,i=t.xyz,r=e[0]-i[0],s=e[1]-i[1],h=e[2]-i[2];return n(r*r+s*s+h*h)},toString:function(){return"["+this.xyz[0]+" , "+this.xyz[1]+" , "+this.xyz[2]+"]"}});r.ZERO=function(){return new r([0,0,0])},r.dot=function(t,e){var n=t.xyz,i=e.xyz;return n[0]*i[0]+n[1]*i[1]+n[2]*i[2]},r.equals=function(t,e){var n=t.xyz,i=e.xyz;return n[0]==i[0]&&n[1]==i[1]&&n[2]==i[2]},r.cross=function(t,e){var n=t.xyz,i=e.xyz,s=n[0],h=n[1],o=n[2],a=i[0],u=i[1],c=i[2];return new r([h*c-o*u,o*a-s*c,s*u-h*a])},r.distance=function(t,e){var i=t.xyz,r=e.xyz,s=i[0]-r[0],h=i[1]-r[1],o=i[2]-r[2];return n(s*s+h*h+o*o)},r.sum=function(t,e){var n=t.xyz,i=e.xyz;return new r([n[0]+i[0],n[1]+i[1],n[2]+i[2]])}}(MOD3),function(t,e){var n,i,r=Math.sin,s=Math.cos,h=t.Matrix4=t.Extends(Object,{constructor:function(t,n,i,r,s,h,o,a,u,c,l,f,x,y,d,v){this.n11=t===e?1:t,this.n12=n===e?0:n,this.n13=i===e?0:i,this.n14=r===e?0:r,this.n21=s===e?0:s,this.n22=h===e?1:h,this.n23=o===e?0:o,this.n24=a===e?0:a,this.n31=u===e?0:u,this.n32=c===e?0:c,this.n33=l===e?1:l,this.n34=f===e?0:f,this.n41=x===e?0:x,this.n42=y===e?0:y,this.n43=d===e?0:d,this.n44=v===e?1:v},n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,reset:function(){return this.n11=1,this.n12=0,this.n13=0,this.n14=0,this.n21=0,this.n22=1,this.n23=0,this.n24=0,this.n31=0,this.n32=0,this.n33=1,this.n34=0,this.n41=0,this.n42=0,this.n43=0,this.n44=1,this},translationMatrix:function(t,e,n){return this.n14=t,this.n24=e,this.n34=n,this},translationMatrixFromVector:function(t){var e=t.xyz;return this.n14=e[0],this.n24=e[1],this.n34=e[2],this},scaleMatrix:function(t,e,n){return this.n11=t,this.n22=e,this.n33=n,this},scaleMatrixFromVector:function(t){var e=t.xyz;return this.n11=e[0],this.n22=e[0],this.n33=e[0],this},rotationMatrix:function(t,e,n,i){var h=s(i),o=r(i),a=1-h,u=t*e*a,c=e*n*a,l=t*n*a,f=o*n,x=o*e,y=o*t;return this.n11=h+t*t*a,this.n12=-f+u,this.n13=x+l,this.n14=0,this.n21=f+u,this.n22=h+e*e*a,this.n23=-y+c,this.n24=0,this.n31=-x+l,this.n32=y+c,this.n33=h+n*n*a,this.n34=0,this},rotationMatrixFromVector:function(t,e){var n=t.xyz,i=n[0],h=n[1],o=n[2],a=s(e),u=r(e),c=1-a,l=i*h*c,f=h*o*c,x=i*o*c,y=u*o,d=u*h,v=u*i;return this.n11=a+i*i*c,this.n12=-y+l,this.n13=d+x,this.n14=0,this.n21=y+l,this.n22=a+h*h*c,this.n23=-v+f,this.n24=0,this.n31=-d+x,this.n32=v+f,this.n33=a+o*o*c,this.n34=0,this},multiply:function(t){return n(this,t),this},multiplyVector:function(t){var e=t.xyz,n=e[0],i=e[1],r=e[2];return e[0]=n*this.n11+i*this.n12+r*this.n13+this.n14,e[1]=n*this.n21+i*this.n22+r*this.n23+this.n24,e[2]=n*this.n31+i*this.n32+r*this.n33+this.n34,t}});i=h.multiplyVector=function(t,e){var n=e.xyz,i=n[0],r=n[1],s=n[2];return n[0]=i*t.n11+r*t.n12+s*t.n13+t.n14,n[1]=i*t.n21+r*t.n22+s*t.n23+t.n24,n[2]=i*t.n31+r*t.n32+s*t.n33+t.n34,e},n=h.calculateMultiply=function(t,e){var n=t.n11,i=e.n11,r=t.n21,s=e.n21,h=t.n31,o=e.n31,a=t.n12,u=e.n12,c=t.n22,l=e.n22,f=t.n32,x=e.n32,y=t.n13,d=e.n13,v=t.n23,m=e.n23,g=t.n33,p=e.n33,M=t.n14,V=e.n14,w=t.n24,z=e.n24,X=t.n34,O=e.n34;return t.n11=n*i+a*s+y*o,t.n12=n*u+a*l+y*x,t.n13=n*d+a*m+y*p,t.n14=n*V+a*z+y*O+M,t.n21=r*i+c*s+v*o,t.n22=r*u+c*l+v*x,t.n23=r*d+c*m+v*p,t.n24=r*V+c*z+v*O+w,t.n31=h*i+f*s+g*o,t.n32=h*u+f*l+g*x,t.n33=h*d+f*m+g*p,t.n34=h*V+f*z+g*O+X,t}}(MOD3),function(t,e){var n=t.ModConstant,i=n.X,r=n.Y,s=n.Z,h=t.Vector3,o=t.VecArray;t.VertexProxy=t.Extends(Object,{constructor:function(t){this.xyz=new o([0,0,0]),this.original=new o([0,0,0]),this.ratio=new o([0,0,0]),e!==t&&null!==t&&!1!==t&&this.setVertex(t)},vertex:null,xyz:null,original:null,ratio:null,setVertex:function(t){return this.vertex=t,this},getRatioVector:function(){return new h(this.ratio)},getRatio:function(t){switch(t){case i:return this.ratio[0];case r:return this.ratio[1];case s:return this.ratio[2]}return-1},getOriginalValue:function(t){switch(t){case i:return this.original[0];case r:return this.original[1];case s:return this.original[2]}return 0},setRatios:function(t,n,i){return t=t===e?0:t,n=n===e?0:n,i=i===e?0:i,this.ratio=new o([t,n,i]),this},setOriginalPosition:function(t,n,i){return t=t===e?0:t,n=n===e?0:n,i=i===e?0:i,this.original=new o([t,n,i]),this},getXYZ:function(){return new o(this.xyz)},getXYZRef:function(){return this.xyz},getX:function(){return this.xyz[0]},getY:function(){return this.xyz[1]},getZ:function(){return this.xyz[2]},setXYZ:function(t){return t=new o(t),this},setXYZRef:function(t){return t=t,this},setX:function(t){return this.xyz[0]=t,this},setY:function(t){return this.xyz[1]=t,this},setZ:function(t){return this.xyz[2]=t,this},getValue:function(t){switch(t){case i:return this.getX();case r:return this.getY();case s:return this.getZ()}return 0},setValue:function(t,e){switch(t){case i:this.setX(e);break;case r:this.setY(e);break;case s:this.setZ(e)}return this},reset:function(){return this.setXYZ(this.original),this},collapse:function(){return this.original=this.getXYZ(),this},getVector:function(){return new h(this.getXYZ())},setVector:function(t){this.setXYZ(t.xyz)}})}(MOD3),function(t){t.FaceProxy=t.Extends(Object,{constructor:function(){this.vertices=[]},vertices:null,addVertex:function(t){this.vertices.push(t)},getVertices:function(){return this.vertices}})}(MOD3),function(t){var e=t.ModConstant,n=e.X,i=e.Y,r=e.Z,s=Math.min,h=Math.max;t.MeshProxy=t.Extends(Object,{constructor:function(t){this.maxX=null,this.maxY=null,this.maxZ=null,this.minX=null,this.minY=null,this.minZ=null,this.maxAxis=null,this.midAxis=null,this.minAxis=null,this.width=null,this.height=null,this.depth=null,this.vertices=[],this.faces=[],this.mesh=null,t&&this.setMesh(t)},maxX:null,maxY:null,maxZ:null,minX:null,minY:null,minZ:null,maxAxis:null,midAxis:null,minAxis:null,widht:null,height:null,depth:null,vertices:null,faces:null,mesh:null,setMesh:function(t){return this.mesh=t,this.vertices=[],this},getVertices:function(){return this.vertices},getFaces:function(){return this.faces},analyzeGeometry:function(){var t,e,o,a,u,c,l,f,x,y,d,v,m,g=this.vertices,p=g.length,M=p;for(p&&(t=g[0],e=t.getXYZ(),o=e[0],a=e[1],u=e[2],c=l=o,f=x=a,y=d=u);--M>=0;)t=g[M],e=t.getXYZ(),o=e[0],a=e[1],u=e[2],t.setOriginalPosition(o,a,u),c=s(c,o),f=s(f,a),y=s(y,u),l=h(l,o),x=h(x,a),d=h(d,u);v=l-c,m=x-f,depth=d-y,this.width=v,this.height=m,this.depth=depth,this.minX=c,this.maxX=l,this.minY=f,this.maxY=x,this.minZ=y,this.maxZ=d;var V=h(v,m,depth),w=s(v,m,depth);for(V==v&&w==m?(this.minAxis=i,this.midAxis=r,this.maxAxis=n):V==v&&w==depth?(this.minAxis=r,this.midAxis=i,this.maxAxis=n):V==m&&w==v?(this.minAxis=n,this.midAxis=r,this.maxAxis=i):V==m&&w==depth?(this.minAxis=r,this.midAxis=n,this.maxAxis=i):V==depth&&w==v?(this.minAxis=n,this.midAxis=i,this.maxAxis=r):V==depth&&w==m&&(this.minAxis=i,this.midAxis=n,this.maxAxis=r),M=p;--M>=0;)t=g[M],e=t.getXYZ(),t.setRatios((e[0]-c)/v,(e[1]-f)/m,(e[2]-y)/depth);return this},resetGeometry:function(){for(var t=this.vertices,e=t.length;--e>=0;)t[e].reset();return this.update(),this},collapseGeometry:function(){for(var t=this.vertices,e=t.length;--e>=0;)t[e].collapse();return this.update(),this.analyzeGeometry(),this},getMin:function(t){switch(t){case n:return this.minX;case i:return this.minY;case r:return this.minZ}return-1},getMax:function(t){switch(t){case n:return this.maxX;case i:return this.maxY;case r:return this.maxZ}return-1},getSize:function(t){switch(t){case n:return this.width;case i:return this.height;case r:return this.depth}return-1},update:function(){return this},postApply:function(){return this},updateMeshPosition:function(){return this}})}(MOD3),function(t){t.Modifier=t.Extends(Object,{constructor:function(t){this.mod=t||null},mod:null,setModifiable:function(t){return this.mod=t,this},getVertices:function(){return this.mod.getVertices()},apply:function(){return this}})}(MOD3),function(t){t.Library3d=t.Extends(Object,{constructor:function(){this.id="",this.meshClass=null,this.vertexClass=null},id:"",meshClass:null,vertexClass:null})}(MOD3),function(t){t.PluginFactory={getMeshProxy:function(t){var e=t.meshClass;return e?new e:null}}}(MOD3),function(t){var e=t.PluginFactory.getMeshProxy;t.ModifierStack=t.Extends(Object,{constructor:function(t,n){this.baseMesh=null,this.stack=[],this.lib3d=t,this.baseMesh=e(t),this.baseMesh.setMesh(n),this.baseMesh.analyzeGeometry()},lib3d:null,baseMesh:null,stack:null,addModifier:function(t){return t.setModifiable(this.baseMesh),this.stack.push(t),this},apply:function(){var t=this.stack,e=t.length,n=this.baseMesh,i=0;for(n.resetGeometry();e>i;)t[i++].apply();return n.update(),this},collapse:function(){return this.apply(),this.baseMesh.collapseGeometry(),this.stack.length=0,this},clear:function(){return this.stack.length=0,this},getMeshInfo:function(){return this.baseMesh}})}(MOD3),function(t){var e=t.Vector3;t.Pivot=t.Extends(t.Modifier,{constructor:function(t,n,i){this.pivot=new e([t,n,i])},pivot:null,setMeshCenter:function(){var t=this.mod;return this.pivot=new e(-(t.minX+.5*t.width),-(t.minY+.5*t.height),-(t.minZ+.5*t.depth)),this},apply:function(){for(var t,e=this.mod.getVertices(),n=e.length,i=this.pivot;--n>=0;)t=e[n],t.setVector(t.getVector().addSelf(i));return this.mod.updateMeshPosition(i.negate()),this}})}(MOD3),function(t,e){var n=t.ModConstant.NONE,i=t.ModConstant.LEFT,r=t.ModConstant.RIGHT,s=t.Matrix,h=Math.atan,o=(Math.atan2,Math.sin),a=Math.cos,u=t.Constants.PI,c=t.Constants.halfPI,l=t.Constants.doublePI,f=t.Point;t.Bend=t.Extends(t.Modifier,{constructor:function(t,i,r){this.constraint=n,this.max=0,this.min=0,this.mid=0,this.width=0,this.height=0,this.origin=0,this.m1=null,this.m2=null,this.diagAngle=0,this.switchAxes=!1,this.force=t!==e?t:0,this.offset=i!==e?i:0,r!==e?this.setAngle(r):this.setAngle(0)},force:0,offset:0,angle:0,diagAngle:0,constraint:n,max:0,min:0,mid:0,width:0,height:0,origin:0,m1:null,m2:null,switchAxes:!1,setAngle:function(t){return this.angle=t,this.m1=(new s).rotate(t),this.m2=(new s).rotate(-t),this},setModifiable:function(t){return this.superCall("setModifiable",t),this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis,this.min=this.mod.minAxis,this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis,this.width=this.mod.getSize(this.max),this.height=this.mod.getSize(this.mid),this.origin=this.mod.getMin(this.max),this.diagAngle=h(this.width/this.height),this},apply:function(){if(!this.force)return this;for(var t,e,n,s,h,x,y,d,v,m,g=this.mod.getVertices(),p=g.length,M=this.constraint,V=this.width,w=this.offset,z=this.origin,X=this.force,O=this.max,P=this.min,A=this.mid,Z=this.m1,E=this.m2,Y=z+V*w,b=V/u/X,I=l*(V/(b*l)),C=1/V;--p>=0;)t=g[p],e=t.getValue(O),n=t.getValue(A),s=t.getValue(P),h=Z.transformPointSelf(new f(e,n)),e=h.x,n=h.y,x=(e-z)*C,M==i&&w>=x||M==r&&x>=w||(y=c-I*w+I*x,d=o(y)*(b+s),v=a(y)*(b+s),s=d-b,e=Y-v),m=E.transformPointSelf(new f(e,n)),e=m.x,n=m.y,t.setValue(O,e),t.setValue(A,n),t.setValue(P,s);return this}})}(MOD3),function(t){var e=t.Vector3,n=Math.max,i=Math.exp;t.Bloat=t.Extends(t.Modifier,{constructor:function(){this.radius=0,this.a=.01,this.center=e.ZERO()},center:null,radius:0,a:.01,setRadius:function(t){return this.radius=n(0,t),this},setA:function(t){return this.a=n(0,t),this},apply:function(){for(var t,e,n,r=this.mod.getVertices(),s=r.length,h=this.center,o=this.radius,a=this.a;--s>=0;)t=r[s],n=t.getVector().subtractSelf(h),e=n.getMagnitude(),n.setMagnitude(e+o*i(-e*a)),t.setVector(n.addSelf(h));return this}})}(MOD3),function(t,e){var n=t.Vector3,i=t.Matrix4;t.Twist=t.Extends(t.Modifier,{constructor:function(t){this.vector=new n([0,1,0]),this.angle=t!==e?t:0,this.center=n.ZERO(),this.mat1=new i,this.mat2=new i},vector:null,angle:0,center:null,mat1:null,mat2:null,apply:function(){for(var t,e,i,r=this.mod,s=r.getVertices(),h=s.length,o=this.vector.normalizeSelf(),a=this.angle,u=this.center,c=new n([.5*r.maxX,.5*r.maxY,.5*r.maxZ]),l=1/c.getMagnitude(),f=l*a,x=-n.dot(o,u);--h>=0;)t=s[h],i=t.getVector(),e=n.dot(i,o)+x,t.setVector(this.twistPoint(i,o,e*f));return this},twistPoint:function(t,e,i){var r=this.mat1.reset().translationMatrixFromVector(t),s=this.mat2.reset().rotationMatrixFromVector(e,i);return s.multiply(r),new n([s.n14,s.n24,s.n34])}})}(MOD3),function(t,e){var n=Math.abs,i=Math.pow,r=(t.XMath.sign,t.ModConstant),s=r.NONE,h=r.LEFT,o=r.RIGHT,a=r.X,u=r.Y,c=r.Z;t.Skew=t.Extends(t.Modifier,{constructor:function(t){this.force=t!==e?t:0,this.offset=.5,this.constraint=s,this.power=1,this.falloff=1,this.inverseFalloff=!1,this.oneSide=!1,this.swapAxes=!1,this.skewAxis=0},force:0,skewAxis:0,offset:.5,constraint:s,power:1,falloff:1,inverseFalloff:!1,oneSide:!1,swapAxes:!1,setModifiable:function(t){return this.superCall("setModifiable",t),this.skewAxis=this.skewAxis||this.mod.maxAxis,this},apply:function(){for(var t,e,r,s,a,u,c,l,f=this.mod.getVertices(),x=f.length,y=this.constraint,d=this.skewAxis,v=this.offset,m=this.oneSide,g=this.inverseFalloff,p=this.falloff,M=1-p,V=this.power,w=this.force,z=this.getDisplaceAxis();--x>=0;)t=f[x],c=t.getRatio(d),y==h&&v>=c||y==o&&c>v||(e=c-v,m&&(e=n(e)),r=t.getRatio(z),g&&(r=1-r),s=p+r*M,l=0>e?-1:1,a=i(n(e),V)*l,u=t.getValue(z)+w*a*s,t.setValue(z,u));return this},getDisplaceAxis:function(){var t=this.skewAxis,e=this.swapAxes;switch(t){case a:return e?c:u;case u:return e?c:a;case c:return e?u:a}}})}(MOD3),function(t,e){var n=t.Vector3,i=t.Matrix4,r=Math.pow;t.Taper=t.Extends(t.Modifier,{constructor:function(t){this.vector=new n([1,0,1]),this.vector2=new n([0,1,0]),this.force=t!==e?t:0,this.power=1},force:0,power:1,vector:null,vector2:null,apply:function(){var t,e,n,s,h,o,a=this.mod.getVertices(),u=a.length,c=this.vector,l=this.vector2,f=this.force,x=this.power;for(s=new i;--u>=0;)t=a[u],e=t.getRatioVector().multiply(l),n=1!=x?f*r(e.getMagnitude(),x):f*e.getMagnitude(),o=c.xyz,s.reset().scaleMatrix(1+n*o[0],1+n*o[1],1+n*o[2]),h=t.getVector(),t.setVector(s.multiplyVector(h));return this}})}(MOD3),function(t){var e=t.Constants.invPI,n=t.Constants.doublePI,i=t.Vector3,r=t.Matrix4;t.Wheel=t.Extends(t.Modifier,{constructor:function(){this.speed=0,this.turn=0,this.roll=0,this.radius=0,this.steerVector=new i([0,1,0]),this.rollVector=new i([0,0,1])},speed:0,turn:0,roll:0,radius:0,steerVector:null,rollVector:null,setModifiable:function(t){return this.superCall("setModifiable",t),this.radius=.5*this.mod.width,this},apply:function(){var t,e,n=this.mod.getVertices(),i=n.length,s=this.steerVector,h=this.turn,o=this.rollVector,a=this.roll,u=null,c=null,l=null;for(this.roll+=this.speed,h?(c=(new r).rotationMatrixFromVector(s,h),l=c.multiplyVector(o.clone()),u=(new r).rotationMatrixFromVector(l,a)):u=(new r).rotationMatrixFrom(o,a);--i>=0;)t=n[i],e=t.getVector(),c&&c.multiplyVector(e),setVector(u.multiplyVector(e));return this},getStep:function(){return this.radius*this.speed*e},getPerimeter:function(){return this.radius*n}})}(MOD3),function(t,e){var n=t.Vector3,i=t.Range,r=t.Matrix4;t.Break=t.Extends(t.Modifier,{constructor:function(t,r){this.bv=new n([0,1,0]),this.range=new i(0,1),this.offset=t!==e?t:0,this.angle=r!==e?r:0},bv:null,range:null,offset:0,angle:0,apply:function(){var t,e,i,s,h,o=this.mod,a=o.getVertices(),u=a.length,c=this.offset,l=this.range,f=this.angle,x=this.bv,y=x.xyz;for(t=new n([0,0,-(o.minZ+o.depth*c)]),e=t.negate(),h=(new r).rotationMatrix(y[0],y[1],y[2],f);--u>=0;)i=a[u],s=i.getVector().addSelf(t),s.xyz[2]>=0&&l.isIn(i.ratio[1])&&h.multiplyVector(s),i.setVector(s.addSelf(e));return this}})}(MOD3),function(t,e){var n=t.ModConstant.NONE,i=t.ModConstant.X,r=t.ModConstant.Y,s=t.ModConstant.Z,h=(t.VecArray,Math.random);t.Noise=t.Extends(t.Modifier,{constructor:function(t){this.axc=n,this.start=0,this.end=0,this.force=t!==e?t:0},force:0,axc:n,start:0,end:1,constraintAxes:function(t){return this.axc=t,this},setFalloff:function(t,n){return this.start=t!==e?t:0,this.end=n!==e?n:1,this},apply:function(){for(var t,e,n,o,a,u=this.mod,c=this.axc,l=this.start,f=this.end,x=u.getVertices(),y=x.length,d=this.force,v=.5*d;--y>=0;)t=x[y],e=h()*d-v,n=t.getRatio(u.maxAxis),f>l?l>n?n=0:n>f&&(n=1):l>f?(n=1-n,n>l?n=0:f>n&&(n=1)):n=1,o=e*n,a=t.getXYZ(),t.setXYZ([a[0]+(c&i?0:o),a[1]+(c&r?0:o),a[2]+(c&s?0:o)]);return this}})}(MOD3),function(t){var e=t.ModConstant,n=e.X,i=e.Y,r=e.Z,s=t.Vector3,h=t.VecArray,o=t.VertexThree=t.Extends(t.VertexProxy,{constructor:function(t,e){this.mesh=t,this.superCall("constructor",e)},mesh:null,setVertex:function(t){return this.vertex=t,this.original=new h([t.x,t.y,t.z]),this.xyz=new h(this.original),this},getXYZ:function(){var t=this.vertex;return new h([t.x,t.y,t.z])},getX:function(){return this.vertex.x},getY:function(){return this.vertex.y},getZ:function(){return this.vertex.z},setXYZ:function(t){var e=this.vertex;return this.mesh.geometry,e.x=t[0],e.y=t[1],e.z=t[2],this},setX:function(t){var e=this.vertex;return e.x=t,this},setY:function(t){var e=this.vertex;return e.y=t,this},setZ:function(t){var e=this.vertex;return e.z=t,this},reset:function(){var t=this.vertex,e=(this.mesh.geometry,this.original);return t.x=e[0],t.y=e[1],t.z=e[2],this},collapse:function(){var t=this.vertex;return this.original=new h([t.x,t.y,t.z]),this},getValue:function(t){var e=this.vertex;switch(t){case n:return e.x;case i:return e.y;case r:return e.z}return 0},setValue:function(t,e){var s=this.vertex,h=!1;switch(t){case n:s.x=e,h=!0;break;case i:s.y=e,h=!0;break;case r:s.z=e,h=!0}return this},setVector:function(t){var e=this.vertex,n=t.xyz;return this.mesh.geometry,e.x=n[0],e.y=n[1],e.z=n[2],this},getVector:function(){var t=this.vertex;return new s([t.x,t.y,t.z])}});o.prototype.getXYZRef=o.prototype.getXYZ,o.prototype.setXYZRef=o.prototype.setXYZ}(MOD3),function(t){var e=t.VertexThree;t.FaceProxy,t.MeshThree=t.Extends(t.MeshProxy,{constructor:function(t){this.superCall("constructor",t)},setMesh:function(t){this.superCall("setMesh",t);var n,i=0,t=this.mesh,r=this.vertices,s=t.geometry.vertices,h=s.length,o=t.geometry.faces;for(o.length,i=0;h>i;)n=new e(t,s[i]),r.push(n),i++;return this.faces=null,this},update:function(){var t=this.mesh.geometry;return t.verticesNeedUpdate=!0,t.normalsNeedUpdate=!0,t.buffersNeedUpdate=!0,t.dynamic=!0,this},updateMeshPosition:function(t){var e=this.mesh.position,n=t.xyz;return e.x+=n[0],e.y+=n[1],e.z+=n[2],this}})}(MOD3),function(t){var e=t.Extends(t.Library3d,{constructor:function(){this.id="Three.js",this.meshClass=t.MeshThree,this.vertexClass=t.VertexThree}});t.LibraryThree=new e}(MOD3),function(t){var e=t.ModConstant,n=e.X,i=e.Y,r=e.Z,s=t.Vector3,h=t.VecArray,o=t.VertexJ3D=t.Extends(t.VertexProxy,{constructor:function(t,e){this.geometry=t,this.VERTEX_POSITION=J3D.Mesh.VERTEX_POSITION,this.superCall("constructor",e)},geometry:null,VERTEX_POSITION:null,setVertex:function(t){var e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data;return this.vertex=t,this.original=new h([i[t],i[t+1],i[t+2]]),this.xyz=new h(this.original),this},getXYZ:function(){var t=this.vertex,e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data;return new h([i[t],i[t+1],i[t+2]])},getX:function(){var t=this.vertex,e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data;return i[t]},getY:function(){var t=this.vertex,e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data;return i[t+1]},getZ:function(){var t=this.vertex,e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data;return i[t+2]},setXYZ:function(t){var e=this.vertex,n=this.geometry,i=n.arraysByName[this.VERTEX_POSITION],r=i.data;return r[e]=t[0],r[e+1]=t[1],r[e+2]=t[2],this},setX:function(t){var e=this.vertex,n=this.geometry,i=n.arraysByName[this.VERTEX_POSITION],r=i.data;return r[e]=t,this},setY:function(t){var e=this.vertex,n=this.geometry,i=n.arraysByName[this.VERTEX_POSITION],r=i.data;return r[e+1]=t,this},setZ:function(t){var e=this.vertex,n=this.geometry,i=n.arraysByName[this.VERTEX_POSITION],r=i.data;return r[e+2]=t,this},reset:function(){var t=this.vertex,e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data,r=this.original;return i[t]=r[0],i[t+1]=r[1],i[t+2]=r[2],this},collapse:function(){var t=this.vertex,e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data;return this.original=new h([i[t],i[t+1],i[t+2]]),this},getValue:function(t){var e=this.vertex,s=this.geometry,h=s.arraysByName[this.VERTEX_POSITION],o=h.data;switch(t){case n:return o[e];case i:return o[e+1];case r:return o[e+2]}return 0},setValue:function(t,e){var s=this.vertex,h=this.geometry,o=h.arraysByName[this.VERTEX_POSITION],a=o.data,u=!1;switch(t){case n:a[s]=e,u=!0;break;case i:a[s+1]=e,u=!0;break;case r:a[s+2]=e,u=!0}return this},setVector:function(t){var e=this.vertex,n=this.geometry,i=n.arraysByName[this.VERTEX_POSITION],r=i.data,s=t.xyz;return r[e]=s[0],r[e+1]=s[1],r[e+2]=s[2],this},getVector:function(){var t=this.vertex,e=this.geometry,n=e.arraysByName[this.VERTEX_POSITION],i=n.data;return new s([i[t],i[t+1],i[t+2]])}});o.prototype.getXYZRef=o.prototype.getXYZ,o.prototype.setXYZRef=o.prototype.setXYZ}(MOD3),function(t){var e=t.VertexJ3D;t.FaceProxy,t.VecArray,t.MeshJ3D=t.Extends(t.MeshProxy,{constructor:function(t){this.VERTEX_POSITION=J3D.Mesh.VERTEX_POSITION,this.superCall("constructor",t)},VERTEX_POSITION:null,setMesh:function(t){this.superCall("setMesh",t);var n,i=0,r=t.geometry,s=r.arraysByName[this.VERTEX_POSITION],h=s.data,o=h.length,a=s.itemSize,u=this.vertices;for(i=0;o>i;)n=new e(r,i),u.push(n),i+=a;return this.faces=null,this},update:function(){var t=this.mesh.geometry,e=t.arraysByName[this.VERTEX_POSITION],n=e.data;return t.replaceArray(e,n),this},updateMeshPosition:function(t){var e=this.mesh.position,n=t.xyz;return e.x+=n[0],e.y+=n[1],e.z+=n[2],this}})}(MOD3),function(t){var e=t.Extends(t.Library3d,{constructor:function(){this.id="J3D",this.meshClass=t.MeshJ3D,this.vertexClass=t.VertexJ3D}});t.LibraryJ3D=new e}(MOD3),function(t){var e=t.ModConstant,n=e.X,i=e.Y,r=e.Z,s=t.Vector3,h=t.VecArray,o=t.VertexCopperlicht=t.Extends(t.VertexProxy,{constructor:function(t,e,n){this.node=t,this.buffer=e,this.superCall("constructor",n)},node:null,buffer:null,setVertex:function(t){var e=t.Pos;return this.vertex=t,this.original=new h([e.X,e.Y,e.Z]),this.xyz=new h(this.original),this},getXYZ:function(){var t=this.vertex.Pos;return new h([t.X,t.Y,t.Z])},getX:function(){return this.vertex.Pos.X},getY:function(){return this.vertex.Pos.Y},getZ:function(){return this.vertex.Pos.Z},setXYZ:function(t){var e=this.vertex.Pos;return e.X=t[0],e.Y=t[1],e.Z=t[2],this},setX:function(t){var e=this.vertex.Pos;return e.X=t,this},setY:function(t){var e=this.vertex.Pos;return e.Y=t,this},setZ:function(t){var e=this.vertex.Pos;return e.Z=t,this},reset:function(){var t=this.vertex.Pos,e=this.original;return t.X=e[0],t.Y=e[1],t.Z=e[2],this},collapse:function(){var t=this.vertex.Pos;return this.original=new h([t.X,t.Y,t.Z]),this},getValue:function(t){var e=this.vertex.Pos;switch(t){case n:return e.X;case i:return e.Y;case r:return e.Z}return 0},setValue:function(t,e){var s=this.vertex.Pos,h=!1;switch(t){case n:s.X=e,h=!0;break;case i:s.Y=e,h=!0;break;case r:s.Z=e,h=!0}return this},setVector:function(t){var e=this.vertex.Pos,n=t.xyz;return e.X=n[0],e.Y=n[1],e.Z=n[2],this},getVector:function(){var t=this.vertex.Pos;return new s([t.X,t.Y,t.Z])}});o.prototype.getXYZRef=o.prototype.getXYZ,o.prototype.setXYZRef=o.prototype.setXYZ}(MOD3),function(t){var e=t.VertexCopperlicht;t.FaceProxy,t.MeshCopperlicht=t.Extends(t.MeshProxy,{constructor:function(t){this.superCall("constructor",t)},setMesh:function(t){this.superCall("setMesh",t);var n,i,r,s,h,o=this.mesh.getMesh().GetMeshBuffers(),a=this.vertices,u=[];for(i=0,r=o.length;r>i;i++)for(u=o[i].Vertices,n=0,s=u.length;s>n;n++)h=new e(this.mesh,o[i],u[n]),a.push(h);return this.faces=null,this},update:function(){for(var t=this.mesh.getMesh().GetMeshBuffers(),e=t.length,n=0;e>n;)t[n].update(!0),n++;return this},updateMeshPosition:function(t){var e=this.mesh.Pos,n=t.xyz;return e.X+=n[0],e.Y+=n[1],e.Z+=n[2],this}})}(MOD3),function(t){var e=t.Extends(t.Library3d,{constructor:function(){this.id="Copperlicht",this.meshClass=t.MeshCopperlicht,this.vertexClass=t.VertexCopperlicht}});t.LibraryCopperlicht=new e}(MOD3),function(t){var e=t.ModConstant,n=e.X,i=e.Y,r=e.Z,s=t.Vector3,h=t.VecArray,o=t.VertexCubicVR=t.Extends(t.VertexProxy,{constructor:function(t,e){this.sceneObject=t,this.superCall("constructor",e)},sceneObject:null,setVertex:function(t){return this.vertex=t,this.original=new h(t),this.xyz=new h(t),this},getXYZ:function(){return new h(this.vertex)},getX:function(){return this.vertex[0]},getY:function(){return this.vertex[1]},getZ:function(){return this.vertex[2]},setXYZ:function(t){var e=this.vertex;return e[0]=t[0],e[1]=t[1],e[2]=t[2],this},setX:function(t){var e=this.vertex;return e[0]=t,this},setY:function(t){var e=this.vertex;return e[1]=t,this},setZ:function(t){var e=this.vertex;return e[2]=t,this},reset:function(){var t=this.vertex,e=this.original;return t[0]=e[0],t[1]=e[1],t[2]=e[2],this},collapse:function(){return this.original=new h(this.vertex),this},getValue:function(t){var e=this.vertex;switch(t){case n:return e[0];case i:return e[1];case r:return e[2]}return 0},setValue:function(t,e){var s=this.vertex,h=!1;switch(t){case n:s[0]=e,h=!0;break;case i:s[1]=e,h=!0;break;case r:s[2]=e,h=!0}return this},setVector:function(t){var e=this.vertex,n=t.xyz;return e[0]=n[0],e[1]=n[1],e[2]=n[2],this},getVector:function(){return new s(this.vertex)}});o.prototype.getXYZRef=o.prototype.getXYZ,o.prototype.setXYZRef=o.prototype.setXYZ}(MOD3),function(t){var e=t.VertexCubicVR;t.FaceProxy,t.MeshCubicVR=t.Extends(t.MeshProxy,{constructor:function(t){this.superCall("constructor",t)},setMesh:function(t){this.superCall("setMesh",t);var n,i=0,r=t.obj.points,s=r.length,h=t.obj.faces,o=(h.length,this.vertices);
for(i=0;s>i;)n=new e(t,r[i]),o.push(n),i++;return this.faces=null,this},update:function(){return this.mesh.dirty=!0,this},updateMeshPosition:function(t){var e=this.mesh.position,n=t.xyz;return e[0]+=n[0],e[1]+=n[1],e[2]+=n[2],this}})}(MOD3),function(t){var e=t.Extends(t.Library3d,{constructor:function(){this.id="CubicVR.js",this.meshClass=t.MeshCubicVR,this.vertexClass=t.VertexCubicVR}});t.LibraryCubicVR=new e}(MOD3),function(t){var e=t.ModConstant,n=e.X,i=e.Y,r=e.Z,s=t.Vector3,h=t.VecArray,o=t.VertexPre3D=t.Extends(t.VertexProxy,{constructor:function(t){this.superCall("constructor",t)},setVertex:function(t){return this.vertex=t,this.original=new h([t.x,t.y,t.z]),this.xyz=new h(this.original),this},getXYZ:function(){var t=this.vertex;return new h([t.x,t.y,t.z])},getX:function(){return this.vertex.x},getY:function(){return this.vertex.y},getZ:function(){return this.vertex.z},setXYZ:function(t){var e=this.vertex;return e.x=t[0],e.y=t[1],e.z=t[2],this},setX:function(t){return this.vertex.x=t,this},setY:function(t){return this.vertex.y=t,this},setZ:function(t){return this.vertex.z=t,this},getValue:function(t){var e=this.vertex;switch(t){case n:return e.x;case i:return e.y;case r:return e.z}return 0},setValue:function(t,e){var s=this.vertex;switch(t){case n:s.x=e;break;case i:s.y=e;break;case r:s.z=e}return this},setVector:function(t){var e=this.vertex,n=t.xyz;return e.x=n[0],e.y=n[1],e.z=n[2],this},getVector:function(){var t=this.vertex;return new s([t.x,t.y,t.z])}});o.prototype.getXYZRef=o.prototype.getXYZ,o.prototype.setXYZRef=o.prototype.setXYZ}(MOD3),function(t){var e=t.VertexPre3D;t.FaceProxy,t.MeshPre3D=t.Extends(t.MeshProxy,{constructor:function(t){this.superCall("constructor",t)},setMesh:function(t){this.superCall("setMesh",t);var n,i,r=this.mesh.vertices,s=this.mesh.quads,h=r.length,o=(s.length,this.vertices);for(n=0;h>n;n++)i=new e(r[n]),o.push(i);return this.faces=null,this}})}(MOD3),function(t){var e=t.Extends(t.Library3d,{constructor:function(){this.id="pre3d.js",this.meshClass=t.MeshPre3D,this.vertexClass=t.VertexPre3D}});t.LibraryPre3D=new e}(MOD3);